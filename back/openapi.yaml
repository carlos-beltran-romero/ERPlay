openapi: 3.0.3
info:
  title: ERPlay Public API
  version: 1.2.0
  description: |
    API pública utilizada por las aplicaciones web de alumnos y supervisores de ERPlay.
    Todos los endpoints requieren autenticación mediante JWT Bearer salvo los de autenticación.
servers:
  - url: https://api.erplay.local/api
    description: Entorno de producción (ejemplo)
  - url: http://localhost:3000/api
    description: Entorno de desarrollo local
security:
  - bearerAuth: []
tags:
  - name: Auth
    description: Autenticación y recuperación de credenciales
  - name: Users
    description: Gestión de perfiles de usuario y administración de estudiantes
  - name: Diagrams
    description: Mantenimiento de diagramas ER y su banco de preguntas
  - name: Admin
    description: Recursos analíticos para supervisores
  - name: Questions
    description: Flujo de creación y revisión de preguntas
  - name: Claims
    description: Gestión de reclamaciones de estudiantes sobre preguntas
  - name: Progress
    description: Métricas de progreso y hábitos de estudio del estudiante
  - name: Dashboard
    description: Feed de actividad para el panel del alumno
  - name: Exams
    description: Generación de exámenes aleatorios
  - name: TestSessions
    description: Gestión de sesiones de práctica y examen
  - name: Supervisor
    description: Herramientas avanzadas para supervisores
paths:
  /auth/login:
    post:
      tags: [Auth]
      summary: Iniciar sesión
      description: Devuelve tokens de acceso y refresco válidos para un usuario registrado.
      operationId: login
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
      responses:
        "200":
          description: Inicio de sesión correcto
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthTokens"
        "401":
          description: Credenciales incorrectas
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /auth/logout:
    post:
      tags: [Auth]
      summary: Cerrar sesión
      description: Invalida el refresh token activo del usuario autenticado.
      operationId: logout
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RefreshTokenRequest"
      responses:
        "204":
          description: Sesión cerrada correctamente
        "401":
          description: Token inválido o expirado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /auth/refresh:
    post:
      tags: [Auth]
      summary: Renovar tokens
      description: Genera un nuevo par de tokens a partir de un refresh token válido.
      operationId: refreshTokens
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RefreshTokenRequest"
      responses:
        "200":
          description: Tokens renovados
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthTokens"
        "400":
          description: Refresh token inválido
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /auth/forgot-password:
    post:
      tags: [Auth]
      summary: Solicitar restablecimiento de contraseña
      description: Envía un correo con instrucciones para restablecer la contraseña.
      operationId: requestPasswordReset
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ForgotPasswordRequest"
      responses:
        "200":
          description: Solicitud aceptada
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MessageResponse"
  /auth/reset-password:
    post:
      tags: [Auth]
      summary: Restablecer contraseña
      description: Define una nueva contraseña a partir de un token de restablecimiento válido.
      operationId: resetPassword
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ResetPasswordRequest"
      responses:
        "200":
          description: Contraseña restablecida correctamente
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MessageResponse"
        "400":
          description: Token inválido o caducado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /users/me:
    get:
      tags: [Users]
      summary: Obtener perfil del usuario autenticado
      operationId: getCurrentUser
      responses:
        "200":
          description: Perfil del usuario autenticado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserProfile"
        "401":
          description: No autenticado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    put:
      tags: [Users]
      summary: Actualizar perfil del usuario autenticado
      operationId: updateCurrentUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateProfileRequest"
      responses:
        "200":
          description: Perfil actualizado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserProfile"
        "400":
          description: Datos inválidos
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "409":
          description: Email ya está en uso
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /users/me/password:
    post:
      tags: [Users]
      summary: Cambiar contraseña del usuario autenticado
      operationId: changeMyPassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChangePasswordRequest"
      responses:
        "200":
          description: Contraseña actualizada correctamente
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MessageResponse"
        "400":
          description: Contraseña actual incorrecta o datos inválidos
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /users:
    get:
      tags: [Users]
      summary: Listar estudiantes
      description: Lista los estudiantes dados de alta ordenados por fecha de creación descendente.
      operationId: listUsers
      responses:
        "200":
          description: Lista de estudiantes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/UserSummary"
  /users/batch:
    post:
      tags: [Users]
      summary: Crear usuarios en lote
      description: Crea múltiples estudiantes y omite los emails duplicados o existentes.
      operationId: batchCreateUsers
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/BatchCreateUsersRequest"
      responses:
        "201":
          description: Resultado de la creación en lote
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BatchCreateUsersResponse"
        "400":
          description: Datos inválidos
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /users/{userId}:
    parameters:
      - $ref: "#/components/parameters/UserIdParam"
    get:
      tags: [Users]
      summary: Obtener un usuario por ID
      operationId: getUser
      responses:
        "200":
          description: Datos del usuario solicitado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserProfile"
        "404":
          description: Usuario no encontrado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    put:
      tags: [Users]
      summary: Actualizar usuario
      operationId: updateUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateUserRequest"
      responses:
        "200":
          description: Usuario actualizado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserProfile"
        "400":
          description: Datos inválidos
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: No autorizado para actualizar este usuario
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Usuario no encontrado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "409":
          description: Email en uso por otro usuario
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    delete:
      tags: [Users]
      summary: Eliminar un usuario
      operationId: deleteUser
      responses:
        "204":
          description: Usuario eliminado
        "404":
          description: Usuario no encontrado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /diagrams/public:
    get:
      tags: [Diagrams]
      summary: Listar diagramas disponibles para estudiantes
      operationId: listPublicDiagrams
      responses:
        "200":
          description: Lista de diagramas visibles
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/DiagramPublicSummary"
  /diagrams:
    get:
      tags: [Diagrams]
      summary: Listar diagramas
      operationId: listDiagrams
      responses:
        "200":
          description: Lista de diagramas administrables
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/DiagramSummary"
    post:
      tags: [Diagrams]
      summary: Crear un diagrama
      description: Crea un diagrama a partir de un formulario multipart con imagen y banco de preguntas.
      operationId: createDiagram
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: "#/components/schemas/DiagramCreateRequest"
      responses:
        "201":
          description: Diagrama creado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DiagramCreatedResponse"
        "400":
          description: Datos inválidos o imagen ausente
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /diagrams/{diagramId}:
    parameters:
      - $ref: "#/components/parameters/DiagramIdParam"
    get:
      tags: [Diagrams]
      summary: Obtener un diagrama
      operationId: getDiagram
      responses:
        "200":
          description: Detalle del diagrama
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DiagramDetail"
        "404":
          description: Diagrama no encontrado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    put:
      tags: [Diagrams]
      summary: Actualizar un diagrama
      operationId: updateDiagram
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: "#/components/schemas/DiagramUpdateRequest"
      responses:
        "200":
          description: Diagrama actualizado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MessageResponse"
        "400":
          description: Datos inválidos
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Diagrama no encontrado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    delete:
      tags: [Diagrams]
      summary: Eliminar un diagrama
      operationId: deleteDiagram
      responses:
        "204":
          description: Diagrama eliminado
        "404":
          description: Diagrama no encontrado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /admin/diagrams/{diagramId}/stats:
    parameters:
      - $ref: "#/components/parameters/DiagramIdParam"
    get:
      tags: [Admin]
      summary: Obtener estadísticas avanzadas de un diagrama
      operationId: getDiagramStats
      parameters:
        - in: query
          name: from
          schema:
            type: string
            format: date
          description: Fecha inicial (inclusive) en formato YYYY-MM-DD
        - in: query
          name: to
          schema:
            type: string
            format: date
          description: Fecha final (inclusive) en formato YYYY-MM-DD
      responses:
        "200":
          description: Estadísticas del diagrama
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DiagramStats"
        "400":
          description: Parámetros inválidos
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Diagrama no encontrado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /questions:
    post:
      tags: [Questions]
      summary: Crear una pregunta
      operationId: createQuestion
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/QuestionCreateRequest"
      responses:
        "201":
          description: Pregunta creada
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/QuestionCreatedResponse"
        "400":
          description: Datos inválidos
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /questions/pending/count:
    get:
      tags: [Questions]
      summary: Contador de preguntas pendientes
      operationId: getPendingQuestionsCount
      responses:
        "200":
          description: Número de preguntas pendientes de revisión
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PendingCount"
  /questions/pending:
    get:
      tags: [Questions]
      summary: Listar preguntas pendientes
      operationId: listPendingQuestions
      responses:
        "200":
          description: Preguntas pendientes de revisión
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/PendingQuestion"
  /questions/{questionId}/verify:
    parameters:
      - $ref: "#/components/parameters/QuestionIdParam"
    post:
      tags: [Questions]
      summary: Verificar una pregunta
      operationId: verifyQuestion
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/QuestionVerifyRequest"
      responses:
        "200":
          description: Revisión aplicada
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MessageResponse"
        "400":
          description: Datos inválidos
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: No autorizado para revisar
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Pregunta no encontrada
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /questions/mine:
    get:
      tags: [Questions]
      summary: Listar preguntas creadas por el usuario
      operationId: listMyQuestions
      responses:
        "200":
          description: Preguntas creadas por el usuario autenticado
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/MyQuestion"
  /claims:
    post:
      tags: [Claims]
      summary: Crear reclamación
      operationId: createClaim
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ClaimCreateRequest"
      responses:
        "201":
          description: Reclamación registrada
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ClaimDetail"
        "400":
          description: Datos inválidos
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /claims/mine:
    get:
      tags: [Claims]
      summary: Listar reclamaciones del estudiante
      operationId: listMyClaims
      responses:
        "200":
          description: Reclamaciones creadas por el estudiante
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ClaimDetail"
  /claims/pending:
    get:
      tags: [Claims]
      summary: Listar reclamaciones pendientes
      operationId: listPendingClaims
      responses:
        "200":
          description: Reclamaciones pendientes de revisión
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ClaimDetail"
  /claims/pending/count:
    get:
      tags: [Claims]
      summary: Contador de reclamaciones pendientes
      operationId: getPendingClaimsCount
      responses:
        "200":
          description: Número de reclamaciones pendientes
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PendingCount"
  /claims/{claimId}/verify:
    parameters:
      - $ref: "#/components/parameters/ClaimIdParam"
    post:
      tags: [Claims]
      summary: Verificar reclamación
      operationId: verifyClaim
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ClaimVerifyRequest"
      responses:
        "200":
          description: Reclamación actualizada
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ClaimDetail"
        "400":
          description: Datos inválidos
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: No autorizado para revisar la reclamación
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Reclamación no encontrada
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /progress/overview:
    get:
      tags: [Progress]
      summary: Obtener resumen de progreso
      operationId: getProgressOverview
      responses:
        "200":
          description: Métricas clave del progreso del estudiante
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProgressOverview"
  /progress/trends:
    get:
      tags: [Progress]
      summary: Obtener tendencias de rendimiento
      operationId: getProgressTrends
      parameters:
        - in: query
          name: from
          schema:
            type: string
            format: date
          description: Fecha inicial en formato YYYY-MM-DD
        - in: query
          name: to
          schema:
            type: string
            format: date
          description: Fecha final en formato YYYY-MM-DD
        - in: query
          name: bucket
          schema:
            type: string
            enum: [day, week]
          description: Granularidad de agregación
      responses:
        "200":
          description: Serie temporal de métricas
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ProgressTrendPoint"
  /progress/errors:
    get:
      tags: [Progress]
      summary: Obtener errores frecuentes
      operationId: getProgressErrors
      parameters:
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 50
          description: Número máximo de preguntas problemáticas a devolver
      responses:
        "200":
          description: Preguntas con mayor tasa de error
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ProgressErrorItem"
  /progress/habits:
    get:
      tags: [Progress]
      summary: Obtener hábitos de estudio
      operationId: getStudyHabits
      responses:
        "200":
          description: Estadísticas de hábitos de estudio
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProgressHabits"
  /progress/claims:
    get:
      tags: [Progress]
      summary: Obtener estadísticas de reclamaciones del estudiante
      operationId: getProgressClaims
      responses:
        "200":
          description: Métricas de reclamaciones
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProgressClaimsStats"
  /progress/badges:
    get:
      tags: [Progress]
      summary: Obtener insignias del estudiante
      operationId: getMyBadges
      responses:
        "200":
          description: Insignias obtenidas por el estudiante
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Badge"
  /progress/weekly-goal/progress:
    get:
      tags: [Progress]
      summary: Obtener progreso hacia el objetivo semanal
      operationId: getMyWeeklyGoalProgress
      responses:
        "200":
          description: Estado del objetivo semanal del estudiante
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WeeklyGoalProgress"
  /dashboard/recent:
    get:
      tags: [Dashboard]
      summary: Obtener actividad reciente
      operationId: listRecentActivity
      parameters:
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 50
          description: Número máximo de elementos a devolver (por defecto 8)
        - in: query
          name: offset
          schema:
            type: integer
            minimum: 0
          description: Índice desde el que paginar resultados
      responses:
        "200":
          description: Actividad reciente del estudiante
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/DashboardItem"
  /exams/start:
    get:
      tags: [Exams]
      summary: Iniciar examen aleatorio
      operationId: startExam
      parameters:
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 50
          description: Número de preguntas a incluir en el examen
      responses:
        "200":
          description: Examen generado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ExamStartPayload"
        "400":
          description: No fue posible generar el examen
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /test-sessions/start:
    post:
      tags: [TestSessions]
      summary: Iniciar una sesión de test
      operationId: startTestSession
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TestSessionStartRequest"
      responses:
        "200":
          description: Sesión de test creada
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TestSessionStartResponse"
        "400":
          description: Petición inválida o sin preguntas disponibles
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /test-sessions/{sessionId}/results/{resultId}:
    parameters:
      - $ref: "#/components/parameters/SessionIdParam"
      - $ref: "#/components/parameters/ResultIdParam"
    patch:
      tags: [TestSessions]
      summary: Actualizar resultado de pregunta
      operationId: patchTestResult
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TestResultPatchRequest"
      responses:
        "200":
          description: Actualización confirmada
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OperationAck"
        "400":
          description: Datos inválidos o resultado inexistente
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /test-sessions/{sessionId}/events:
    parameters:
      - $ref: "#/components/parameters/SessionIdParam"
    post:
      tags: [TestSessions]
      summary: Registrar evento de sesión
      operationId: logTestEvent
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TestEventRequest"
      responses:
        "200":
          description: Evento registrado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OperationAck"
        "400":
          description: Datos inválidos o sesión inexistente
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /test-sessions/{sessionId}/finish:
    parameters:
      - $ref: "#/components/parameters/SessionIdParam"
    post:
      tags: [TestSessions]
      summary: Finalizar sesión de test
      operationId: finishTestSession
      responses:
        "200":
          description: Resumen de la sesión finalizada
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TestSessionFinishResponse"
        "400":
          description: Sesión inválida o inexistente
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /test-sessions/mine:
    get:
      tags: [TestSessions]
      summary: Listar mis sesiones de test
      operationId: listMyTestSessions
      parameters:
        - in: query
          name: mode
          schema:
            type: string
            enum: [learning, exam, errors]
          description: Filtrar por modo de test
        - in: query
          name: dateFrom
          schema:
            type: string
            format: date
          description: Fecha inicial del filtro
        - in: query
          name: dateTo
          schema:
            type: string
            format: date
          description: Fecha final del filtro
        - in: query
          name: q
          schema:
            type: string
          description: Texto a buscar en el título del diagrama
      responses:
        "200":
          description: Sesiones del usuario
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/TestSessionSummary"
  /test-sessions/{sessionId}:
    parameters:
      - $ref: "#/components/parameters/SessionIdParam"
    get:
      tags: [TestSessions]
      summary: Obtener detalle de una sesión de test
      operationId: getTestSessionDetail
      responses:
        "200":
          description: Detalle completo de la sesión
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TestSessionDetail"
        "404":
          description: Sesión no encontrada
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /supervisor/students/{studentId}:
    parameters:
      - $ref: "#/components/parameters/StudentIdParam"
    get:
      tags: [Supervisor]
      summary: Obtener información básica de un estudiante
      operationId: supervisorGetStudent
      responses:
        "200":
          description: Información del estudiante
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserProfile"
        "404":
          description: Estudiante no encontrado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /supervisor/students/{studentId}/progress/overview:
    parameters:
      - $ref: "#/components/parameters/StudentIdParam"
    get:
      tags: [Supervisor]
      summary: Obtener resumen de progreso del estudiante
      operationId: supervisorGetProgressOverview
      responses:
        "200":
          description: Métricas de progreso del estudiante
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProgressOverview"
  /supervisor/students/{studentId}/progress/trends:
    parameters:
      - $ref: "#/components/parameters/StudentIdParam"
    get:
      tags: [Supervisor]
      summary: Obtener tendencias de progreso del estudiante
      operationId: supervisorGetProgressTrends
      responses:
        "200":
          description: Serie temporal de progreso
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ProgressTrendPoint"
  /supervisor/students/{studentId}/progress/errors:
    parameters:
      - $ref: "#/components/parameters/StudentIdParam"
    get:
      tags: [Supervisor]
      summary: Obtener errores frecuentes del estudiante
      operationId: supervisorGetProgressErrors
      responses:
        "200":
          description: Preguntas con mayor tasa de error
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ProgressErrorItem"
  /supervisor/students/{studentId}/claims/stats:
    parameters:
      - $ref: "#/components/parameters/StudentIdParam"
    get:
      tags: [Supervisor]
      summary: Obtener estadísticas de reclamaciones del estudiante
      operationId: supervisorGetClaimStats
      responses:
        "200":
          description: Estadísticas de reclamaciones del estudiante
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProgressClaimsStats"
  /supervisor/students/{studentId}/claims:
    parameters:
      - $ref: "#/components/parameters/StudentIdParam"
    get:
      tags: [Supervisor]
      summary: Listar reclamaciones del estudiante
      operationId: supervisorListClaims
      responses:
        "200":
          description: Reclamaciones del estudiante
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ClaimDetail"
  /supervisor/students/{studentId}/badges:
    parameters:
      - $ref: "#/components/parameters/StudentIdParam"
    get:
      tags: [Supervisor]
      summary: Listar insignias del estudiante
      operationId: supervisorListBadges
      responses:
        "200":
          description: Insignias obtenidas por el estudiante
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Badge"
  /supervisor/students/{studentId}/questions:
    parameters:
      - $ref: "#/components/parameters/StudentIdParam"
    get:
      tags: [Supervisor]
      summary: Listar preguntas creadas por el estudiante
      operationId: supervisorListQuestions
      responses:
        "200":
          description: Preguntas creadas por el estudiante
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/MyQuestion"
  /supervisor/students/{studentId}/tests:
    parameters:
      - $ref: "#/components/parameters/StudentIdParam"
    get:
      tags: [Supervisor]
      summary: Listar sesiones de test del estudiante
      operationId: supervisorListTests
      responses:
        "200":
          description: Sesiones de test del estudiante
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/TestSessionSummary"
  /supervisor/students/{studentId}/tests/{sessionId}:
    parameters:
      - $ref: "#/components/parameters/StudentIdParam"
      - $ref: "#/components/parameters/SessionIdParam"
    get:
      tags: [Supervisor]
      summary: Obtener detalle de una sesión de test del estudiante
      operationId: supervisorGetTestDetail
      responses:
        "200":
          description: Detalle de la sesión del estudiante
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TestSessionDetail"
        "404":
          description: Sesión no encontrada
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /supervisor/weekly-goal:
    get:
      tags: [Supervisor]
      summary: Obtener objetivo semanal actual
      operationId: supervisorGetWeeklyGoal
      responses:
        "200":
          description: Objetivo semanal activo
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: "#/components/schemas/WeeklyGoal"
                  - nullable: true
    put:
      tags: [Supervisor]
      summary: Establecer objetivo semanal
      operationId: supervisorSetWeeklyGoal
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/WeeklyGoalUpsertRequest"
      responses:
        "200":
          description: Objetivo semanal actualizado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WeeklyGoal"
        "400":
          description: Datos inválidos para el objetivo
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    post:
      tags: [Supervisor]
      summary: Alias para actualizar el objetivo semanal
      operationId: supervisorPostWeeklyGoal
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/WeeklyGoalUpsertRequest"
      responses:
        "200":
          description: Objetivo semanal actualizado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WeeklyGoal"
        "400":
          description: Datos inválidos
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /supervisor/weekly-goal/progress:
    get:
      tags: [Supervisor]
      summary: Progreso de los estudiantes hacia el objetivo semanal
      operationId: supervisorWeeklyGoalProgress
      responses:
        "200":
          description: Lista de progreso por estudiante
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/WeeklyGoalProgressItem"
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  parameters:
    UserIdParam:
      name: userId
      in: path
      required: true
      schema:
        type: string
        format: uuid
      description: Identificador del usuario
    StudentIdParam:
      name: studentId
      in: path
      required: true
      schema:
        type: string
        format: uuid
      description: Identificador del estudiante
    DiagramIdParam:
      name: diagramId
      in: path
      required: true
      schema:
        type: string
        format: uuid
      description: Identificador del diagrama
    QuestionIdParam:
      name: questionId
      in: path
      required: true
      schema:
        type: string
        format: uuid
      description: Identificador de la pregunta
    ClaimIdParam:
      name: claimId
      in: path
      required: true
      schema:
        type: string
        format: uuid
      description: Identificador de la reclamación
    SessionIdParam:
      name: sessionId
      in: path
      required: true
      schema:
        type: string
        format: uuid
      description: Identificador de la sesión de test
    ResultIdParam:
      name: resultId
      in: path
      required: true
      schema:
        type: string
        format: uuid
      description: Identificador del resultado dentro de la sesión
  schemas:
    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 6
    RefreshTokenRequest:
      type: object
      required: [refreshToken]
      properties:
        refreshToken:
          type: string
    ForgotPasswordRequest:
      type: object
      required: [email]
      properties:
        email:
          type: string
          format: email
    ResetPasswordRequest:
      type: object
      required: [token, newPassword]
      properties:
        token:
          type: string
        newPassword:
          type: string
          minLength: 6
    AuthTokens:
      type: object
      required: [accessToken, refreshToken]
      properties:
        accessToken:
          type: string
          description: Token JWT de acceso (expira en minutos)
        refreshToken:
          type: string
          description: Token JWT de refresco (larga duración)
    MessageResponse:
      type: object
      properties:
        message:
          type: string
      additionalProperties: false
    OperationAck:
      type: object
      required: [ok]
      properties:
        ok:
          type: boolean
    ErrorResponse:
      type: object
      properties:
        error:
          type: string
        message:
          type: string
        code:
          type: string
      additionalProperties: true
    UserProfile:
      type: object
      required: [id, name, lastName, email, role, createdAt]
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        lastName:
          type: string
        email:
          type: string
          format: email
        role:
          type: string
          enum: [alumno, supervisor]
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
          nullable: true
    UserSummary:
      allOf:
        - $ref: "#/components/schemas/UserProfile"
        - type: object
          properties:
            createdAt:
              type: string
              format: date-time
    UpdateProfileRequest:
      type: object
      properties:
        name:
          type: string
        lastName:
          type: string
        email:
          type: string
          format: email
      additionalProperties: false
    ChangePasswordRequest:
      type: object
      required: [currentPassword, newPassword]
      properties:
        currentPassword:
          type: string
        newPassword:
          type: string
          minLength: 6
      additionalProperties: false
    BatchCreateUsersRequest:
      type: object
      required: [users]
      properties:
        users:
          type: array
          minItems: 1
          items:
            type: object
            required: [email, password]
            properties:
              email:
                type: string
                format: email
              password:
                type: string
                minLength: 6
              name:
                type: string
              lastName:
                type: string
    BatchCreateUsersResponse:
      type: object
      required: [created, skipped]
      properties:
        created:
          type: array
          items:
            $ref: "#/components/schemas/UserSummary"
        skipped:
          type: object
          required: [exists, payloadDuplicates]
          properties:
            exists:
              type: array
              items:
                type: string
                format: email
            payloadDuplicates:
              type: array
              items:
                type: string
                format: email
    UpdateUserRequest:
      type: object
      properties:
        email:
          type: string
          format: email
        name:
          type: string
        lastName:
          type: string
        password:
          type: string
          minLength: 6
      additionalProperties: false
    DiagramPublicSummary:
      type: object
      required: [id, title]
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        path:
          type: string
          nullable: true
          description: Ruta relativa a la imagen asociada
    DiagramSummary:
      allOf:
        - $ref: "#/components/schemas/DiagramPublicSummary"
        - type: object
          properties:
            createdAt:
              type: string
              format: date-time
            questionsCount:
              type: integer
              minimum: 0
    DiagramCreateRequest:
      type: object
      required: [title, image, questions]
      properties:
        title:
          type: string
        image:
          type: string
          format: binary
        questions:
          type: string
          description: JSON serializado con el arreglo de preguntas
    DiagramUpdateRequest:
      type: object
      required: [title, questions]
      properties:
        title:
          type: string
        questions:
          type: string
          description: JSON serializado con el arreglo de preguntas
        image:
          type: string
          format: binary
          description: Imagen opcional para reemplazar la existente
    DiagramCreatedResponse:
      type: object
      required: [id]
      properties:
        id:
          type: string
          format: uuid
        path:
          type: string
          nullable: true
    DiagramDetail:
      allOf:
        - $ref: "#/components/schemas/DiagramSummary"
        - type: object
          properties:
            questions:
              type: array
              items:
                $ref: "#/components/schemas/DiagramQuestion"
    DiagramQuestion:
      type: object
      required: [id, prompt, options]
      properties:
        id:
          type: string
          format: uuid
        prompt:
          type: string
        hint:
          type: string
        options:
          type: array
          items:
            type: string
        correctIndex:
          type: integer
          minimum: 0
    DiagramStats:
      type: object
      required:
        [
          kpis,
          trends,
          histogramExam10,
          scatterSpeedVsAccuracy,
          hotspots,
          riskStudents,
        ]
      properties:
        kpis:
          type: object
          properties:
            examScoreAvg10:
              type: number
            learningAccuracyPct:
              type: number
            masteryRatePct:
              type: number
            atRiskRatePct:
              type: number
            practiceToExamDeltaPts:
              type: number
            medianTimePerQuestionExamSec:
              type: number
            hintUsagePct:
              type: number
            errorConcentrationTop5Pct:
              type: number
              nullable: true
        trends:
          type: array
          items:
            type: object
            properties:
              date:
                type: string
                format: date
              examScorePct:
                type: number
                nullable: true
              learningAccuracyPct:
                type: number
                nullable: true
        histogramExam10:
          type: array
          items:
            type: object
            properties:
              label:
                type: string
              count:
                type: integer
        scatterSpeedVsAccuracy:
          type: array
          items:
            type: object
            properties:
              studentId:
                type: string
                nullable: true
              name:
                type: string
                nullable: true
              accuracyPct:
                type: number
              timeSecPerQuestion:
                type: number
        hotspots:
          type: array
          items:
            type: object
            properties:
              questionId:
                type: string
              title:
                type: string
              errorRatePct:
                type: number
              medianTimeSec:
                type: number
                nullable: true
              commonWrongText:
                type: string
                nullable: true
              attempts:
                type: integer
        riskStudents:
          type: array
          items:
            type: object
            properties:
              studentId:
                type: string
              name:
                type: string
                nullable: true
              lastName:
                type: string
                nullable: true
              lastExamScore10:
                type: number
              attempts:
                type: integer
              lastAttemptAt:
                type: string
                format: date-time
        itemQuality:
          type: array
          nullable: true
          items:
            type: object
            properties:
              questionId:
                type: string
              title:
                type: string
              pCorrectPct:
                type: number
              discrPointBiserial:
                type: number
              medianTimeSec:
                type: number
                nullable: true
              attempts:
                type: integer
              claimRatePct:
                type: number
              claimApprovalRatePct:
                type: number
                nullable: true
        distractors:
          type: array
          nullable: true
          items:
            type: object
            properties:
              questionId:
                type: string
              optionText:
                type: string
              chosenPct:
                type: number
              chosenPctLowQuartile:
                type: number
                nullable: true
              chosenPctHighQuartile:
                type: number
                nullable: true
        learningCurves:
          type: object
          nullable: true
          properties:
            attemptsToMasteryP50:
              type: number
              nullable: true
            deltaPracticeToExamAvgPts:
              type: number
        reliability:
          type: object
          nullable: true
          properties:
            kr20:
              type: number
              nullable: true
        drift:
          type: array
          nullable: true
          items:
            type: object
            properties:
              questionId:
                type: string
              title:
                type: string
                nullable: true
              deltaPCorrectPct:
                type: number
              deltaMedianTimeSec:
                type: number
                nullable: true
    QuestionCreateRequest:
      type: object
      required: [diagramId, prompt, hint, options, correctIndex]
      properties:
        diagramId:
          type: string
          format: uuid
        prompt:
          type: string
        hint:
          type: string
        options:
          type: array
          minItems: 2
          items:
            type: string
        correctIndex:
          type: integer
          minimum: 0
      additionalProperties: false
    QuestionCreatedResponse:
      type: object
      required: [id, status]
      properties:
        id:
          type: string
          format: uuid
        status:
          type: string
    PendingCount:
      type: object
      required: [count]
      properties:
        count:
          type: integer
          minimum: 0
    PendingQuestion:
      type: object
      required: [id, prompt, options, correctIndex, createdAt]
      properties:
        id:
          type: string
          format: uuid
        prompt:
          type: string
        hint:
          type: string
        options:
          type: array
          items:
            type: string
        correctIndex:
          type: integer
        createdAt:
          type: string
          format: date-time
        creator:
          type: object
          nullable: true
          properties:
            id:
              type: string
            email:
              type: string
              format: email
            name:
              type: string
              nullable: true
        diagram:
          type: object
          nullable: true
          properties:
            id:
              type: string
            title:
              type: string
            path:
              type: string
              nullable: true
    QuestionVerifyRequest:
      type: object
      required: [decision]
      properties:
        decision:
          type: string
          enum: [approve, reject]
        comment:
          type: string
          nullable: true
      additionalProperties: false
    MyQuestion:
      type: object
      required: [id, prompt, status, createdAt, options, correctIndex]
      properties:
        id:
          type: string
        prompt:
          type: string
        status:
          type: string
        reviewComment:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time
        reviewedAt:
          type: string
          format: date-time
          nullable: true
        diagram:
          type: object
          nullable: true
          properties:
            id:
              type: string
            title:
              type: string
            path:
              type: string
              nullable: true
        options:
          type: array
          items:
            type: string
        correctIndex:
          type: integer
    ClaimCreateRequest:
      type: object
      required:
        [diagramId, prompt, options, chosenIndex, correctIndex, explanation]
      properties:
        testResultId:
          type: string
          format: uuid
          nullable: true
        questionId:
          type: string
          format: uuid
          nullable: true
        diagramId:
          type: string
          format: uuid
        prompt:
          type: string
        options:
          type: array
          minItems: 2
          items:
            type: string
        chosenIndex:
          type: integer
          minimum: 0
        correctIndex:
          type: integer
          minimum: 0
        explanation:
          type: string
      additionalProperties: false
    ClaimVerifyRequest:
      type: object
      required: [decision]
      properties:
        decision:
          type: string
          enum: [approve, reject]
        comment:
          type: string
          nullable: true
      additionalProperties: false
    ClaimDetail:
      type: object
      required:
        [id, status, createdAt, diagramId, prompt, chosenIndex, correctIndex]
      properties:
        id:
          type: string
        status:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
          nullable: true
        diagramId:
          type: string
        prompt:
          type: string
        options:
          type: array
          items:
            type: string
        chosenIndex:
          type: integer
        correctIndex:
          type: integer
        explanation:
          type: string
        reviewerComment:
          type: string
          nullable: true
    ProgressOverview:
      type: object
      required:
        [
          accuracyLearningPct,
          examScoreAvg,
          answeredCount,
          avgTimePerQuestionSec,
          sessionsCompleted,
          deltaExamVsLearningPts,
          bestStreakDays,
        ]
      properties:
        accuracyLearningPct:
          type: number
        examScoreAvg:
          type: number
        answeredCount:
          type: integer
        avgTimePerQuestionSec:
          type: number
        sessionsCompleted:
          type: integer
        deltaExamVsLearningPts:
          type: number
        bestStreakDays:
          type: integer
    ProgressTrendPoint:
      type: object
      required: [date, correctCount, incorrectCount]
      properties:
        date:
          type: string
        accuracyLearningPct:
          type: number
          nullable: true
        examScorePct:
          type: number
          nullable: true
        correctCount:
          type: integer
        incorrectCount:
          type: integer
    ProgressErrorItem:
      type: object
      required: [questionId, prompt, errorRatePct]
      properties:
        questionId:
          type: string
        prompt:
          type: string
        attempts:
          type: integer
        errorRatePct:
          type: number
        commonChosenIndex:
          type: integer
          nullable: true
    ProgressHabits:
      type: object
      properties:
        sessionsPerWeek:
          type: number
        avgSessionDurationMinutes:
          type: number
        preferredDays:
          type: array
          items:
            type: string
        preferredHourRange:
          type: string
          nullable: true
    ProgressClaimsStats:
      type: object
      properties:
        totalClaims:
          type: integer
        approvedClaims:
          type: integer
        rejectedClaims:
          type: integer
        pendingClaims:
          type: integer
        approvalRatePct:
          type: number
          nullable: true
    Badge:
      type: object
      required: [id, name]
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
          nullable: true
        earnedAt:
          type: string
          format: date-time
          nullable: true
    WeeklyGoalProgress:
      type: object
      nullable: true
      properties:
        userId:
          type: string
          format: uuid
        target:
          type: integer
        done:
          type: integer
        pct:
          type: integer
        completed:
          type: boolean
        weekStart:
          type: string
          format: date
        weekEnd:
          type: string
          format: date
    DashboardItem:
      type: object
      required: [id, kind, createdAt]
      properties:
        id:
          type: string
        kind:
          type: string
          description: Tipo de actividad (session, question o claim)
        createdAt:
          type: string
          format: date-time
        completedAt:
          type: string
          format: date-time
          nullable: true
        mode:
          type: string
          nullable: true
          description: Modo de la sesión cuando kind = session
        diagramTitle:
          type: string
          nullable: true
        totalQuestions:
          type: integer
          nullable: true
        correctCount:
          type: integer
          nullable: true
        score:
          type: number
          nullable: true
        durationSec:
          type: integer
          nullable: true
        status:
          type: string
          nullable: true
          description: Estado de la pregunta o reclamación
        title:
          type: string
          nullable: true
    ExamStartPayload:
      type: object
      required: [diagram, questions]
      properties:
        diagram:
          type: object
          properties:
            id:
              type: string
            title:
              type: string
            path:
              type: string
              nullable: true
        questions:
          type: array
          items:
            type: object
            required: [id, prompt, options]
            properties:
              id:
                type: string
              prompt:
                type: string
              options:
                type: array
                items:
                  type: string
              hint:
                type: string
                nullable: true
    TestSessionStartRequest:
      type: object
      required: [mode]
      properties:
        mode:
          type: string
          enum: [learning, exam, errors]
        limit:
          type: integer
          minimum: 1
          maximum: 50
    TestSessionStartResponse:
      type: object
      required: [sessionId, diagram, questions]
      properties:
        sessionId:
          type: string
        diagram:
          type: object
          properties:
            id:
              type: string
            title:
              type: string
            path:
              type: string
              nullable: true
        questions:
          type: array
          items:
            type: object
            required: [resultId, prompt, options]
            properties:
              resultId:
                type: string
              questionId:
                type: string
                nullable: true
              prompt:
                type: string
              options:
                type: array
                items:
                  type: string
              correctIndex:
                type: integer
                nullable: true
              hint:
                type: string
                nullable: true
    TestResultPatchRequest:
      type: object
      properties:
        selectedIndex:
          type: integer
          nullable: true
        attemptsDelta:
          type: integer
        usedHint:
          type: boolean
        revealedAnswer:
          type: boolean
        timeSpentSecondsDelta:
          type: number
      additionalProperties: false
    TestEventRequest:
      type: object
      required: [type]
      properties:
        type:
          type: string
        resultId:
          type: string
          nullable: true
        payload:
          type: object
          nullable: true
          additionalProperties: true
      additionalProperties: false
    TestSessionFinishResponse:
      type: object
      required: [sessionId, mode, diagram, totals]
      properties:
        sessionId:
          type: string
        mode:
          type: string
        diagram:
          type: object
          properties:
            id:
              type: string
        totals:
          type: object
          properties:
            totalQuestions:
              type: integer
            correct:
              type: integer
            incorrect:
              type: integer
            durationSeconds:
              type: integer
            score:
              type: number
              nullable: true
    TestSessionSummary:
      type: object
      required: [id, mode, startedAt, diagram, questionCount, summary]
      properties:
        id:
          type: string
        mode:
          type: string
        startedAt:
          type: string
          format: date-time
        finishedAt:
          type: string
          format: date-time
          nullable: true
        diagram:
          type: object
          nullable: true
          properties:
            id:
              type: string
            title:
              type: string
            path:
              type: string
              nullable: true
        questionCount:
          type: integer
        totalQuestions:
          type: integer
        correctCount:
          type: integer
        wrongCount:
          type: integer
        skippedCount:
          type: integer
        score:
          type: number
          nullable: true
        summary:
          type: object
          properties:
            durationSeconds:
              type: integer
              nullable: true
            accuracyPct:
              type: number
              nullable: true
            score:
              type: number
              nullable: true
            noteLabel:
              type: string
              nullable: true
    TestSessionDetail:
      type: object
      required: [id, mode, startedAt, summary, results]
      properties:
        id:
          type: string
        mode:
          type: string
        startedAt:
          type: string
          format: date-time
        finishedAt:
          type: string
          format: date-time
          nullable: true
        durationSeconds:
          type: integer
          nullable: true
        diagram:
          type: object
          nullable: true
          properties:
            id:
              type: string
            title:
              type: string
            path:
              type: string
              nullable: true
        summary:
          type: object
          properties:
            durationSeconds:
              type: integer
              nullable: true
            accuracyPct:
              type: number
              nullable: true
            score:
              type: number
              nullable: true
        results:
          type: array
          items:
            type: object
            required: [resultId, prompt, options, correctIndex]
            properties:
              resultId:
                type: string
              prompt:
                type: string
              options:
                type: array
                items:
                  type: string
              correctIndex:
                type: integer
              selectedIndex:
                type: integer
                nullable: true
              usedHint:
                type: boolean
              revealedAnswer:
                type: boolean
              timeSpentSeconds:
                type: number
              claimed:
                type: boolean
              claimId:
                type: string
                nullable: true
              claimStatus:
                type: string
                nullable: true
              claimCreatedAt:
                type: string
                format: date-time
                nullable: true
    WeeklyGoal:
      type: object
      required: [id, weekStart, weekEnd, targetTests]
      properties:
        id:
          type: string
        weekStart:
          type: string
          format: date
        weekEnd:
          type: string
          format: date
        targetTests:
          type: integer
        notifySentAt:
          type: string
          format: date-time
          nullable: true
    WeeklyGoalUpsertRequest:
      type: object
      required: [targetTests]
      properties:
        targetTests:
          type: integer
          minimum: 1
        weekStart:
          type: string
          format: date
          nullable: true
        weekEnd:
          type: string
          format: date
          nullable: true
        notify:
          type: boolean
          nullable: true
      additionalProperties: false
    WeeklyGoalProgressItem:
      type: object
      required: [userId, name, email, done, target, pct, completed]
      properties:
        userId:
          type: string
          format: uuid
        name:
          type: string
        email:
          type: string
          format: email
        done:
          type: integer
        target:
          type: integer
        pct:
          type: integer
        completed:
          type: boolean
